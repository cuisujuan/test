# safety

## 使用

```
import {jump, isLegalUrl, legalizeUrl} from '@vdian/safety'
```

### 方法

#### option

可配置项：

-   resolveUrl `function` : 解析 URL 函数，用于自定义链接处理规则

-   observeDom `Boolean` ：是否监听 DOM 节点，默认为不开启

```
// 开始监听
option({observeDom: true})
// 取消监听
option({observeDom: false})

// 解析URL函数，用于自定义链接处理规则，作用在legalizeUrl方法
option({
  resolveUrl(url){
		// 处理url
		return '//weidian.com'
  }
})
```

#### addWhiteDomain

添加白名单，与 Cookie Domain 设置规则保持一致，例如 .weidian.com 匹配 www.weidian.com,h5.weidian.com，weidian.com 只匹配 weidian.com。

默认域名白名单可查看 [WHITE_DOMAINS](https://gitlab.vdian.net/v-components/sheer/blob/master/packages/safety/src/constants/index.ts)

使用场景：

> 如果默认域名白名单无法满足业务需求，则可通过该方法添加域名白名单。

```
addWhiteDomain('.meipai.com');
```

#### isLegalUrl

用来检测链接是否合法。检测规则：

1. 检测链接的域名是否在白名单内
2. 检测是否包含 `data:` 和 `javascript:` 协议头

返回值：

> 如果是个合法地址，则返回`true`；如果不合法，则返回`false`。

```
const legal = isLegalUrl(url);
```

#### legalizeUrl

返回值：

> 调用 isLegalUrl 方法检测，如果是个合法地址，则返回`绝对地址`；如果不合法，则返回`javascript:;`。

使用场景：

> 用于在模板或者代码中，过滤不合法的链接地址。

```
url = legalizeUrl(url);
```

#### jump

安全跳转方法。

使用场景：

> 用于替代 window.location.href、 window.location.assign、window.location.replace 方法，在链接跳转的地方统一使用 jump 方法替代。

```
// 替代window.location.href与window.location.assign
jump(url)
// 替代window.location.replace
jump(url, true)
```

#### escape

过滤 < > ' " & ` 等字符，防止 xss 攻击。

使用场景：

> 用于过滤一切输入的数据，输入数据定义见前端安全规范文档。
