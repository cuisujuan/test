import { isObject, forEach, isArray, isError, isWideObject, createError } from '../../util';
function serialize(params) {
    if (isObject(params)) {
        forEach(params, function (value, key) {
            // stringify array and object, most api always use this
            if (isObject(value) || isArray(value)) {
                params[key] = JSON.stringify(value);
            }
        });
    }
}
function handleResponse(_a) {
    var response = _a.response, options = _a.options;
    var data = response.data;
    if (options.responseType === 'json' && !isWideObject(data)) {
        return Promise.reject(createError('JSON Data Error', -1 /* XHR_ERROR */, 1 /* JSON_ERROR */));
    }
    return data;
}
/**
 * @ignore
 */
export default function normal() {
    var context = this;
    context.hooks.push('configured', function (_a, next) {
        var options = _a.options;
        serialize(options.data);
        next();
    });
    var request = context.request;
    // tslint:disable-next-line
    context.request = function () {
        return request
            .apply(context, arguments)
            .then(handleResponse, function (args) {
            // get xhr request error
            var error = isError(args) ? args : args.error;
            return Promise.reject(error);
        });
    };
}
