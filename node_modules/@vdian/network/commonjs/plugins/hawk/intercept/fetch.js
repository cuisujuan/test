"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var util_1 = require("../../../util");
var constants_1 = require("../../../constants");
var FETCH = constants_1.GLOBAL.fetch;
function handleRequestResponse(options, response, next) {
    try {
        if (util_1.isResponseOk(response.status)) {
            return response
                .clone()
                .json()
                .then(function (data) {
                options.beforeSuccess(data, next);
            })
                .catch(function () {
                next();
            });
        }
    }
    catch (e) { }
    next();
}
/**
 * @ignore
 */
function interceptFetch(options) {
    if (!util_1.isNativeFunction(FETCH)) {
        return;
    }
    constants_1.GLOBAL.fetch = function () {
        var args = arguments;
        return FETCH.apply(this, args).then(function (response) {
            return new Promise(function (resolve) {
                handleRequestResponse(options, response, function () {
                    resolve(response);
                });
            });
        });
    };
}
exports.default = interceptFetch;
