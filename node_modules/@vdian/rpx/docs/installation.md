# 安装与使用

## 安装 less 文件

在项目中引入一份样式文件，每个页面只需引入一次即可。

通过 npm 安装。

```
// 安装
npm install @vdian/rpx --save

// 在js文件或vue script标签中引入，代码如下
import '@vdian/rpx/lib/less/index.less';
// 在less文件或vue style标签中引入，代码如下
@import '~@vdian/rpx/lib/less/index.less';
```

通过 CDN 安装，建议与其他文件 combo。

```
<link rel="stylesheet" type="text/css" href="//assets.geilicdn.com/v-components/rpx/版本/index.css">
```

## 安装 rpx-postcss 插件

**对于项目**

如果项目使用的构建工具是 vBuilder，只需开启配置，默认为不开启，代码如下：

```
// vbuilder.config.js 文件
// true 开启rpx 适配
rpx: true
```

如果项目未使用 vBuilder，则需进行插件配置，rpx 插件需配置在`postcss-import` 插件之后。

```
// postcss 插件配置
const plugins = [
	// postcss-import 需配置在该插件前
    require('@vdian/rpx/lib/plugins/rpx')()
    ……
]
```

**对于组件**

对于组件开发建议也采用 rpx 单位，方便扩展与迁移，原因有以下几点：

1. 引入 rpx 中间单位，可转换为任意目标单位。
2. 在等比缩放页面可与页面等比缩放策略保持一致，保证与页面 UI 一致性。在非等比缩放页面可设置固定 html font-size 保证 UI 一致。

但对于横向适配为了具备通用性，方便在各类适配中使用，建议采用 flex 布局，不建议采用 rem 动态计算的方式。

插件配置参照上面所述。

## 安装 rem-loader

由于历史组件存在 10、20、25 等份，无法和 rpx 7.5 等份的项目共存，为了解决该问题，提供了 rem loader，用于将其他等份的 rem 转换为 rpx 单位。

如果项目使用的构建工具是 vBuilder，默认为不开启，代码如下：

```
// vbuilder.config.js 文件
// 如果是10等份则fontSize为75，如果是20等份则fontSize为37.5
remToRpx: {
	fontSize: 75
}
```

如果项目未使用 vBuilder，则需手动配置 rem loader，配置在 less-loader 处理之后，在包含 rpx 处理插件的 postcss-loader 之前，为了职责分离，rem-loader 只将 rem 转换为 rpx，需结合 rpx 插件转换到目标单位，代码如下：

```
test: /\.css$/,
  use: [
  	// 包含rpx插件的postcss-loader
    {
    loader: '@vdian/rpx/lib/loaders/rem',
    options:{
    	fontSize:75
    }
    // less-loader
  }
]
```

## 使用

#### 定义 viewport

该适配方案不进行 viewport 缩放，所以需在 `head` 标签内添加 viewport，代码如下：

```
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
```

#### 定义全局单位变量【非常重要】

在项目中定义一个全局变量，该变量在一个配置文件中管理，不允许出现在多个文件中重复定义该变量，代码如下：

```
// config.less
@u: 1rpx;
```

#### 编写布局代码

在进行布局时，任何涉及到尺寸的地方使用设计稿标注的尺寸，例如：

```
width:500 * @u;
font-size: 24 * @u;
margin:2 * @u;
```

#### API

在 js 代码中会存在将 rpx 单位转换的需求，所以提供了`to` 方法用于将 rpx 换算为目标单位的值，便于集中控制转换后的目标单位和换算比例，不允许自主进行换算，代码如下：

```
import {to} from '@vdian/rpx'

to(750) // 7.5rem

```

## 注意项

#### 1px 边框问题

由于视觉可能会对 1px 边框有要求，该方案未对 viewport 进行缩放，所以 1px solid 无法实现 1px 边框，推荐下面几种方式实现。

**通过 box-shadow**

该方案较为简单且对其他样式影响较小，但由于是通过阴影实现，存在显示颜色比实际颜色谈的问题，可通过调节颜色解决，如果视觉无法接受，可采用伪类实现。

```
// border-top
box-shadow: inset 0 1px 1px -1px #000;
// border-right
box-shadow: inset -1px 0 1px -1px #000;
// border-bottom
box-shadow: inset 0 -1px 1px -1px #000;
// border-left
box-shadow: inset 1px 0 1px -1px #000;
// border
box-shadow: inset 0 0 1px 0 #000;
```

**通过伪类**

利用伪类实现时，有些方案会建议按照 1/devicePixelRatio 的大小进行缩放，在实际显示上，0.33 与 0.5 差别不大，所以可直接使用 0.5 缩放即可。

提供了一个函数方便使用，函数代码如下：

```
.one-px-border(@border-directions: border, @border-color, @border-style: solid, @border-radius: 0) {
    position: relative;
    each(@border-directions, {
        @{value}: none;
    });
    border-radius: @border-radius;
    &:after {
        content: '';
        position: absolute;
        top: -50%;
        right: -50%;
        bottom: -50%;
        left: -50%;
        -webkit-transform: scale(0.5);
        transform: scale(0.5);
        // 缩放了0.5，圆角放大2倍
        border-radius: @border-radius * 2;
        each(@border-directions, {
            @{value}: 1px @border-style @border-color;
        });
    }
}
```

使用方式如下：

```
// 实现 border: 1px solid #ccc
.border{
    .one-px-border(border,#ccc);
	// .one-px-border 使用relative，将absolute放置在后面，经过压缩后relative将被剔除
    position:absolute;
}

// 实现上下边框
.border{
    @directions: border-top, border-bottom;
    .one-px-border(@directions, #ccc);
}

// 实现圆角 5px 圆角
.border{
    .one-px-border(border-top, #ccc, solid, 5px);
}
```

其他实现方案

1. https://www.cnblogs.com/chenwenhao/p/9350425.html
2. https://www.jianshu.com/p/7e63f5a32636

#### rpx 布局问题

rpx 为动态单位，随着屏幕尺寸变化而变化，在 iPhone 6 下 1rpx = 0.5px，在 iPhone 6 plus 下 1rpx = 0.552px，下列代码容易出现布局问题，开发时需注意。

```
// 下面代码会出现横向滚动条，由于在iPhone 6下 容器宽度实际为376px
.container{
    width:748 * @u; // 748rpx
    border:1px solid #ccc;
}
// 解决
.container{
    width:748 * @u; // 748rpx
    border:1px solid #ccc;
    box-sizing: border-box;
}
```

#### font-size 设置问题

在 font-size 设置问题上，有 rpx（动态缩放）与 px（固定像素）两种选择，与设计师沟通后，按钮、标签等字号采用动态缩放会更美观而文字阅读区域使用固定像素会更方便阅读，大致参照的原则是：

下面情况均采用 px 单位

1. 对于以文字阅读为主的部分，例如商详详情描述。
2. 在大屏幕手机需要可视文字更多的部分。
3. 设计师有特殊说明。

其他情况均采用 rpx 单位。
