import * as postcss from 'postcss';
import Big from 'big.js';
import { handleDecl, handleAtRule } from './util';
var REM_REGEXP = /(\.\d+|\d+(\.\d+)?)rem\b/gi;
// 替换
function replaceRem(value, fontSize) {
    value = value.replace(REM_REGEXP, function (match) {
        var str = match.substr(0, match.length - 3);
        var number = Number(str);
        return new Big(number).times(fontSize).toString() + "rpx" /* RPX */;
    });
    return value;
}
var plugin = postcss.plugin('postcss-rem', function (opts) {
    var options = Object.assign({
        fontSize: 75
    }, opts || {});
    function replace(value) {
        return replaceRem(value, options.fontSize);
    }
    return function (root) {
        // 循环css声明
        root.walkDecls(function (decl) {
            handleDecl({ decl: decl }, { replace: replace });
        });
        // 循环 @media 规则
        root.walkAtRules('media', function (rule) {
            handleAtRule({ rule: rule }, { replace: replace });
        });
    };
});
// 兼容老版本
module.exports = plugin;
export default plugin;
