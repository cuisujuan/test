"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var postcss = require("postcss");
var util_1 = require("../util");
var util_2 = require("./util");
var big_js_1 = require("big.js");
// 转换单位
function calculate(value, options) {
    var v = new big_js_1.default(value).div(options.conversionValue).toString();
    return util_2.keepDecimal(v) + options.unit;
}
var plugin = postcss.plugin('postcss-rpx', function (opts) {
    var options = Object.assign({
        unit: "rem" /* REM */,
        conversionValue: 100
    }, opts || {});
    return function (root) {
        // 循环css声明
        root.walkDecls(function (decl) {
            util_2.handleDecl({ decl: decl }, {
                replace: function (value) {
                    return util_1.replaceRpx(value, function (value) {
                        return calculate(value, options);
                    });
                }
            });
        });
        // 循环 @media 规则
        root.walkAtRules('media', function (rule) {
            util_2.handleAtRule({ rule: rule }, {
                replace: function (value) {
                    return util_1.replaceRpx(value, function (value) {
                        return calculate(value, options);
                    });
                }
            });
        });
    };
});
// 兼容老版本
module.exports = plugin;
exports.default = plugin;
