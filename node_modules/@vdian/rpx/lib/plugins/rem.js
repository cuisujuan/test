"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var postcss = require("postcss");
var big_js_1 = require("big.js");
var util_1 = require("./util");
var REM_REGEXP = /(\.\d+|\d+(\.\d+)?)rem\b/gi;
// 替换
function replaceRem(value, fontSize) {
    value = value.replace(REM_REGEXP, function (match) {
        var str = match.substr(0, match.length - 3);
        var number = Number(str);
        return new big_js_1.default(number).times(fontSize).toString() + "rpx" /* RPX */;
    });
    return value;
}
var plugin = postcss.plugin('postcss-rem', function (opts) {
    var options = Object.assign({
        fontSize: 75
    }, opts || {});
    function replace(value) {
        return replaceRem(value, options.fontSize);
    }
    return function (root) {
        // 循环css声明
        root.walkDecls(function (decl) {
            util_1.handleDecl({ decl: decl }, { replace: replace });
        });
        // 循环 @media 规则
        root.walkAtRules('media', function (rule) {
            util_1.handleAtRule({ rule: rule }, { replace: replace });
        });
    };
});
// 兼容老版本
module.exports = plugin;
exports.default = plugin;
