#### 技术方案

##### 实现

对外提供的功能方法如下：

##### 登录角色校验

`isLogin` 判定当前环境是否已经登录（如果有，则默认是买家登录）

【入参】：无;

【返回】: true/false

```javascript
function isLogin(){
  return (getCookie(IS_LOGIN) || getCookie(WD_B_ID) || getCookie(WD_S_ID)) ? true : false;
}
```

`isSellerLogin`判定是否是纯卖家方式登录（卖家一定是买家，但买家不一定是卖家）

【入参】：无;

【返回】: true/false

```javascript
function isSellerLogin(){
 return isLogin() && getCookie(WD_S_ID) ? true : false;
}
```

##### 登录方式校验（支付宝方式的业务场景较少，故暂不考虑）

`isWechatLogin`判定是否是微信方式登录

【入参】：无;

【返回】: true/false

```javascript
function isWechatLogin(){
 return isLogin() && getCookie(LOGIN_USER_SOURCE) === "LOGIN_USER_SOURCE_WECHAT" ? true : false;
}
```

`isQQLogin`判定是否是qq方式登录

【入参】：无;

【返回】: true/false

【方法结构】同上

`isSubAccount`判定是否是子账号登录

【参数】：无;

【返回】: true/false

【使用方式】同上

##### 获取用户信息

`getUserInfo`  调取用户的信息接口

【入参】：options

```json
{
  environment（选传）:当前环境值；0：开发环境；1：日常环境；2：预发环境；3：线上环境,
  success: function(result){...},
  error:function(result){...}
}
```

result返回的数据格式

```json
{"status":
   {"code":0,
    "message":"OK",
    "description":""
   },
 "result":{}
}
```

【返回】：

```json
{
"status":{
 "code":0, //错误码，成功则为0
 "message": "OK",//错误含义
 "description": ""
}
"result":{
"user":{
 "code": //国家码
 "phone"://手机号
}
"buyer":{
 "code": //国家码
 "phone"://手机号
}
"seller":{
 "code": //国家码
 "phone"://手机号
}
"info":{
"headImgUrl"://用户头像
"nickName"://用户昵称
"qqHeadImgUrl"://qq昵称
"qqNickName"://qq头像
"shopID"://店铺id
"shopName"://店铺名称
"shopLogo"://店铺头像
"wxHeadImgUrl"://微信头像
"wxNickName"://微信昵称
}
}
}
```

对应的接口信息如下：

1. 【请求】POST {HOST}/user/getinfo
2. 【参数】token 客户端内网调用，例如 http://test.sso.intra.weidian.com/user/getinfo?token=xxxx
3. 【响应】JSONP
4. 注：该方法统一采取Jsonp格式，兼容IE7+

##### 微信登录

`wechatSlientLogin`微信静默授权方式登录

【入参】：options {url:重定向url , environment:当前环境值}(选传)

【返回】：无

【方法结构】

```javascript
window.location.href = {host} + '/user/oauth/wechat/silentlogin?redirect=' + encodeURIComponent("目标url");
```

`wechatForceLogin`微信强制授权方式登录

【入参】：无

【返回】：无

【方法结构】

```javascript
window.location.href = {host} + '/user/oauth/wechat/login?redirect=' + encodeURIComponent("目标url");
```

##### 普通登录/登出

`login`登录跳转

【参数】options可选参数配置项(选传)

```json
{
  url: 重定向的url，若不传，则默认获取当前访问页面的url
  environment:当前环境值，若不传，则默认解析识别当前页面的url的环境值
  oauth:是否显示第三方登录；oauth=0不显示；不传参，默认显示
  deviceType:区别h5端或者pc端；h5端：deviceType=1,pc端：deviceType=0；（如果不传，默认为h5端，建议手动传递该值）
}
```

分为PC端和H5端跳转

pc端(线上版)：

```javascript
window.location.href = 'https://h5.weidian.com/m/signin/index.html?redirect='+encodeURIComponent("目标url");
```

H5移动端（线上版）：

```javascript
window.location.href = 'https://h5.weidian.com/m/login/index.html?redirect='+encodeURIComponent("目标url");
```

`logout`登出跳转

【参数】【选传】options {url:重定向url , environment:当前环境值}

```javascript
window.location.href = {host}+"/user/logout?redirect=" + encodeURIComponent("目标url");
```

#### 